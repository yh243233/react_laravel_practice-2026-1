!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanillaInternals={})}(this,function(n){"use strict";function e(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=Array(e);r<e;r++)t[r]=n[r];return t}function r(n,r){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(t)return(t=t.call(n)).next.bind(t);if(Array.isArray(n)||(t=function(n,r){if(n){if("string"==typeof n)return e(n,r);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(n,r):void 0}}(n))||r){t&&(n=t);var a=0;return function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function t(n){return"init"in n}function a(n){return!!n.write}function o(n){return"v"in n||"e"in n}function i(n){if("e"in n)throw n.e;return n.v}var u=new WeakMap;function l(n){var e;return c(n)&&!(null==(e=u.get(n))||!e[0])}function f(n){var e=u.get(n);null!=e&&e[0]&&(e[0]=!1,e[1].forEach(function(n){return n()}))}function d(n,e){var r=u.get(n);if(!r){r=[!0,new Set],u.set(n,r);var t=function(){r[0]=!1};n.then(t,t)}r[1].add(e)}function c(n){return"function"==typeof(null==n?void 0:n.then)}function v(n,e,r){if(!r.p.has(n)){r.p.add(n);var t=function(){return r.p.delete(n)};e.then(t,t)}}function s(n,e,t){for(var a,o=new Set,i=r((null==(u=t.get(n))?void 0:u.t)||[]);!(a=i()).done;){var u,l=a.value;o.add(l)}for(var f,d=r(e.p);!(f=d()).done;){var c=f.value;o.add(c)}return o}var y=function(){var n={},e=new WeakMap,r=function(r){var t,a;null==(t=e.get(n))||t.forEach(function(n){return n(r)}),null==(a=e.get(r))||a.forEach(function(n){return n()})};return r.add=function(r,t){var a=r||n,o=e.get(a);return o||(o=new Set,e.set(a,o)),o.add(t),function(){o.delete(t),o.size||e.delete(a)}},r};var h=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.read.apply(e,t)},p=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.write.apply(e,t)},g=function(n,e){return e.INTERNAL_onInit?e.INTERNAL_onInit(n):e.unstable_onInit?(console.warn("[DEPRECATED] atom.unstable_onInit is renamed to atom.INTERNAL_onInit."),e.unstable_onInit(n)):void 0},w=function(n,e,r){return null==e.onMount?void 0:e.onMount(r)},A=function(n,e){var r=z(n),t=r[0],a=r[6],o=r[9],i=t.get(e);return i||(i={d:new Map,p:new Set,n:0},t.set(e,i),null==a.i||a.i(e),null==o||o(n,e)),i},N=function(n){var e=z(n),r=e[1],t=e[3],a=e[4],o=e[5],i=e[6],u=e[13],l=[],f=function(n){try{n()}catch(n){l.push(n)}},d=function(){i.f&&f(i.f);var e=new Set,l=e.add.bind(e);t.forEach(function(n){var e;return null==(e=r.get(n))?void 0:e.l.forEach(l)}),t.clear(),o.forEach(l),o.clear(),a.forEach(l),a.clear(),e.forEach(f),t.size&&u(n)};do{d()}while(t.size||o.size||a.size);if(l.length)throw new AggregateError(l)},E=function(n){for(var e=z(n),t=e[1],a=e[2],o=e[3],i=e[11],u=e[14],l=e[17],f=[],d=new WeakSet,c=new WeakSet,v=Array.from(o);v.length;){var y=v[v.length-1],h=i(n,y);if(c.has(y))v.pop();else if(d.has(y))a.get(y)===h.n&&f.push([y,h]),c.add(y),v.pop();else{d.add(y);for(var p,g=r(s(y,h,t));!(p=g()).done;){var w=p.value;d.has(w)||v.push(w)}}}for(var A=f.length-1;A>=0;--A){for(var N,E=f[A],m=E[0],b=!1,I=r(E[1].d.keys());!(N=I()).done;){var S=N.value;if(S!==m&&o.has(S)){b=!0;break}}b&&(u(n,m),l(n,m)),a.delete(m)}},m=(new WeakSet,function(n,e){var u=z(n),f=u[1],s=u[2],y=u[3],h=u[6],p=u[7],g=u[11],w=u[12],A=u[13],N=u[14],E=u[16],m=u[17],b=u[20],I=g(n,e);if(o(I)){if(f.has(e)&&s.get(e)!==I.n)return I;for(var S,T=!1,R=r(I.d);!(S=R()).done;){var k=S.value,_=k[0],L=k[1];if(N(n,_).n!==L){T=!0;break}}if(!T)return I}I.d.clear();var M,W,P=!0;function j(){f.has(e)&&(m(n,e),A(n),w(n))}var x={get signal(){return M||(M=new AbortController),M.signal},get setSelf(){return!W&&a(e)&&(W=function(){if(!P)try{for(var r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return E.apply(void 0,[n,e].concat(t))}finally{A(n),w(n)}}),W}},D=I.n;try{0;var O=p(n,e,function(r){if(r===e){var a=g(n,r);if(!o(a)){if(!t(r))throw new Error("no atom init");b(n,r,r.init)}return i(a)}var u=N(n,r);try{return i(u)}finally{var d;I.d.set(r,u.n),l(I.v)&&v(e,I.v,u),f.has(e)&&(null==(d=f.get(r))||d.t.add(e)),P||j()}},x);return b(n,e,O),c(O)&&(d(O,function(){var n;return null==(n=M)?void 0:n.abort()}),O.then(j,j)),null==h.r||h.r(e),I}catch(n){return delete I.v,I.e=n,++I.n,I}finally{P=!1,D!==I.n&&s.get(e)===D&&(s.set(e,I.n),y.add(e),null==h.c||h.c(e))}}),b=function(n,e){for(var t=z(n),a=t[1],o=t[2],i=t[11],u=[e];u.length;)for(var l,f=u.pop(),d=r(s(f,i(n,f),a));!(l=d()).done;){var c=l.value,v=i(n,c);o.set(c,v.n),u.push(c)}},I=function(n,e){var r=z(n),a=r[3],o=r[6],u=r[8],l=r[11],f=r[12],d=r[13],c=r[14],v=r[15],s=r[16],y=r[17],h=r[20],p=!0;try{for(var g=arguments.length,w=new Array(g>2?g-2:0),A=2;A<g;A++)w[A-2]=arguments[A];return u.apply(void 0,[n,e,function(e){return i(c(n,e))},function(r){var i=l(n,r);try{for(var u=arguments.length,c=new Array(u>1?u-1:0),g=1;g<u;g++)c[g-1]=arguments[g];if(r===e){if(!t(r))throw new Error("atom not writable");var w=i.n,A=c[0];return h(n,r,A),y(n,r),void(w!==i.n&&(a.add(r),v(n,r),null==o.c||o.c(r)))}return s.apply(void 0,[n,r].concat(c))}finally{p||(d(n),f(n))}}].concat(w))}finally{p=!1}},S=function(n,e){var t=z(n),a=t[1],o=t[3],i=t[6],u=t[11],f=t[15],d=t[18],c=t[19],v=u(n,e),s=a.get(e);if(s&&!l(v.v)){for(var y,h=r(v.d);!(y=h()).done;){var p=y.value,g=p[0],w=p[1];if(!s.d.has(g)){var A=u(n,g);d(n,g).t.add(e),s.d.add(g),w!==A.n&&(o.add(g),f(n,g),null==i.c||i.c(g))}}for(var N,E=r(s.d);!(N=E()).done;){var m=N.value;if(!v.d.has(m)){s.d.delete(m);var b=c(n,m);null==b||b.t.delete(e)}}}},T=function(n,e){var t=z(n),o=t[1],i=t[4],u=t[6],l=t[10],f=t[11],d=t[12],c=t[13],v=t[14],s=t[16],y=t[18],h=f(n,e),p=o.get(e);if(!p){v(n,e);for(var g,w=r(h.d.keys());!(g=w()).done;){var A=g.value;y(n,A).t.add(e)}if(p={l:new Set,d:new Set(h.d.keys()),t:new Set},o.set(e,p),a(e)){i.add(function(){var r=!0;try{var t=l(n,e,function(){try{for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return s.apply(void 0,[n,e].concat(a))}finally{r||(c(n),d(n))}});t&&(p.u=function(){r=!0;try{t()}finally{r=!1}})}finally{r=!1}})}null==u.m||u.m(e)}return p},R=function(n,e){var t=z(n),a=t[1],o=t[5],i=t[6],u=t[11],l=t[19],f=u(n,e),d=a.get(e);if(!d||d.l.size)return d;for(var c,v=!1,s=r(d.t);!(c=s()).done;){var y,h=c.value;if(null!=(y=a.get(h))&&y.d.has(e)){v=!0;break}}if(v)return d;d.u&&o.add(d.u),d=void 0,a.delete(e);for(var p,g=r(f.d.keys());!(p=g()).done;){var w=l(n,p.value);null==w||w.t.delete(e)}null==i.u||i.u(e)},k=function(n,e,t){var a=z(n)[11],o=a(n,e),i="v"in o,u=o.v;if(c(t))for(var l,d=r(o.d.keys());!(l=d()).done;){v(e,t,a(n,l.value))}o.v=t,delete o.e,i&&Object.is(u,o.v)||(++o.n,c(u)&&f(u))},_=function(n,e){return i((0,z(n)[14])(n,e))},L=function(n,e){var r=z(n),t=r[12],a=r[13],o=r[16];try{for(var i=arguments.length,u=new Array(i>2?i-2:0),l=2;l<i;l++)u[l-2]=arguments[l];return o.apply(void 0,[n,e].concat(u))}finally{a(n),t(n)}},M=function(n,e,r){var t=z(n),a=t[12],o=t[18],i=t[19],u=o(n,e).l;return u.add(r),a(n),function(){u.delete(r),i(n,e),a(n)}},W=new WeakMap,z=function(n){return W.get(n)};n.INTERNAL_abortPromise=f,n.INTERNAL_addPendingPromiseToDependency=v,n.INTERNAL_buildStoreRev2=function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];var t={get:function(n){return(0,z(t)[21])(t,n)},set:function(n){for(var e=z(t)[22],r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return e.apply(void 0,[t,n].concat(a))},sub:function(n,e){return(0,z(t)[23])(t,n,e)}},a=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},h,p,g,w,A,N,E,m,b,I,S,T,R,k,_,L,M,void 0].map(function(n,r){return e[r]||n});return W.set(t,Object.freeze(a)),t},n.INTERNAL_getBuildingBlocksRev2=function(n){var e=z(n),r=e[24];return r?r(e):e},n.INTERNAL_getMountedOrPendingDependents=s,n.INTERNAL_hasInitialValue=t,n.INTERNAL_initializeStoreHooksRev2=function(n){var e,r,t,a,o,i,u,l;return(e=n).i||(e.i=y()),(r=n).r||(r.r=y()),(t=n).c||(t.c=y()),(a=n).m||(a.m=y()),(o=n).u||(o.u=y()),(i=n).f||(i.f=(u=new Set,(l=function(){return u.forEach(function(n){return n()})}).add=function(n){return u.add(n),function(){return u.delete(n)}},l)),n},n.INTERNAL_isActuallyWritableAtom=a,n.INTERNAL_isAtomStateInitialized=o,n.INTERNAL_isPendingPromise=l,n.INTERNAL_isPromiseLike=c,n.INTERNAL_promiseStateMap=u,n.INTERNAL_registerAbortHandler=d,n.INTERNAL_returnAtomValue=i});
